{"version":3,"sources":["../../../next-server/server/api-utils.ts"],"names":["apiResolver","req","res","query","resolverModule","apiContext","propagateError","onError","apiReq","apiRes","statusCode","end","config","bodyParser","api","externalResolver","setLazyProp","getCookieParser","tryGetPreviewData","previewData","undefined","body","parseBody","sizeLimit","status","sendStatusCode","send","data","sendData","json","sendJson","redirect","statusOrUrl","url","setPreviewData","options","Object","assign","clearPreviewData","resolver","wasPiped","process","env","NODE_ENV","once","console","warn","err","ApiError","sendError","message","error","limit","contentType","headers","type","parameters","encoding","charset","buffer","e","toString","parseJson","qs","require","decode","str","length","JSON","parse","getQueryParser","parseQuery","URL","params","searchParams","key","value","Array","isArray","push","parseCookie","header","cookie","parseCookieFn","join","Error","writeHead","Location","sendEtagResponse","etag","setHeader","getHeader","Stream","pipe","isJSONLike","includes","stringifiedBody","stringify","Buffer","isBuffer","byteLength","jsonBody","COOKIE_NAME_PRERENDER_BYPASS","COOKIE_NAME_PRERENDER_DATA","SYMBOL_PREVIEW_DATA","Symbol","SYMBOL_CLEARED_COOKIES","getCookies","cookies","hasBypass","hasData","previewModeId","tokenPreviewData","jsonwebtoken","encryptedPreviewData","verify","previewModeSigningKey","decryptedPreviewData","from","previewModeEncryptionKey","defineProperty","enumerable","payload","sign","algorithm","maxAge","expiresIn","serialize","previous","httpOnly","sameSite","secure","path","expires","Date","constructor","statusMessage","prop","getter","opts","configurable","optsReset","writable","get","set"],"mappings":"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","sourcesContent":["import { IncomingMessage, ServerResponse } from 'http'\nimport { parse } from 'next/dist/compiled/content-type'\nimport { CookieSerializeOptions } from 'next/dist/compiled/cookie'\nimport generateETag from 'next/dist/compiled/etag'\nimport fresh from 'next/dist/compiled/fresh'\nimport getRawBody from 'next/dist/compiled/raw-body'\nimport { PageConfig } from 'next/types'\nimport { Stream } from 'stream'\nimport { isResSent, NextApiRequest, NextApiResponse } from '../lib/utils'\nimport { decryptWithSecret, encryptWithSecret } from './crypto-utils'\nimport { interopDefault } from './load-components'\nimport { Params } from './router'\n\nexport type NextApiRequestCookies = { [key: string]: string }\nexport type NextApiRequestQuery = { [key: string]: string | string[] }\n\nexport type __ApiPreviewProps = {\n  previewModeId: string\n  previewModeEncryptionKey: string\n  previewModeSigningKey: string\n}\n\nexport async function apiResolver(\n  req: IncomingMessage,\n  res: ServerResponse,\n  query: any,\n  resolverModule: any,\n  apiContext: __ApiPreviewProps,\n  propagateError: boolean,\n  onError?: ({ err }: { err: any }) => Promise<void>\n) {\n  const apiReq = req as NextApiRequest\n  const apiRes = res as NextApiResponse\n\n  try {\n    if (!resolverModule) {\n      res.statusCode = 404\n      res.end('Not Found')\n      return\n    }\n    const config: PageConfig = resolverModule.config || {}\n    const bodyParser = config.api?.bodyParser !== false\n    const externalResolver = config.api?.externalResolver || false\n\n    // Parsing of cookies\n    setLazyProp({ req: apiReq }, 'cookies', getCookieParser(req))\n    // Parsing query string\n    apiReq.query = query\n    // Parsing preview data\n    setLazyProp({ req: apiReq }, 'previewData', () =>\n      tryGetPreviewData(req, res, apiContext)\n    )\n    // Checking if preview mode is enabled\n    setLazyProp({ req: apiReq }, 'preview', () =>\n      apiReq.previewData !== false ? true : undefined\n    )\n\n    // Parsing of body\n    if (bodyParser) {\n      apiReq.body = await parseBody(\n        apiReq,\n        config.api && config.api.bodyParser && config.api.bodyParser.sizeLimit\n          ? config.api.bodyParser.sizeLimit\n          : '1mb'\n      )\n    }\n\n    apiRes.status = (statusCode) => sendStatusCode(apiRes, statusCode)\n    apiRes.send = (data) => sendData(apiReq, apiRes, data)\n    apiRes.json = (data) => sendJson(apiRes, data)\n    apiRes.redirect = (statusOrUrl: number | string, url?: string) =>\n      redirect(apiRes, statusOrUrl, url)\n    apiRes.setPreviewData = (data, options = {}) =>\n      setPreviewData(apiRes, data, Object.assign({}, apiContext, options))\n    apiRes.clearPreviewData = () => clearPreviewData(apiRes)\n\n    const resolver = interopDefault(resolverModule)\n    let wasPiped = false\n\n    if (process.env.NODE_ENV !== 'production') {\n      // listen for pipe event and don't show resolve warning\n      res.once('pipe', () => (wasPiped = true))\n    }\n\n    // Call API route method\n    await resolver(req, res)\n\n    if (\n      process.env.NODE_ENV !== 'production' &&\n      !externalResolver &&\n      !isResSent(res) &&\n      !wasPiped\n    ) {\n      console.warn(\n        `API resolved without sending a response for ${req.url}, this may result in stalled requests.`\n      )\n    }\n  } catch (err) {\n    if (err instanceof ApiError) {\n      sendError(apiRes, err.statusCode, err.message)\n    } else {\n      console.error(err)\n      if (onError) await onError({ err })\n      if (propagateError) {\n        throw err\n      }\n      sendError(apiRes, 500, 'Internal Server Error')\n    }\n  }\n}\n\n/**\n * Parse incoming message like `json` or `urlencoded`\n * @param req request object\n */\nexport async function parseBody(\n  req: NextApiRequest,\n  limit: string | number\n): Promise<any> {\n  const contentType = parse(req.headers['content-type'] || 'text/plain')\n  const { type, parameters } = contentType\n  const encoding = parameters.charset || 'utf-8'\n\n  let buffer\n\n  try {\n    buffer = await getRawBody(req, { encoding, limit })\n  } catch (e) {\n    if (e.type === 'entity.too.large') {\n      throw new ApiError(413, `Body exceeded ${limit} limit`)\n    } else {\n      throw new ApiError(400, 'Invalid body')\n    }\n  }\n\n  const body = buffer.toString()\n\n  if (type === 'application/json' || type === 'application/ld+json') {\n    return parseJson(body)\n  } else if (type === 'application/x-www-form-urlencoded') {\n    const qs = require('querystring')\n    return qs.decode(body)\n  } else {\n    return body\n  }\n}\n\n/**\n * Parse `JSON` and handles invalid `JSON` strings\n * @param str `JSON` string\n */\nfunction parseJson(str: string): object {\n  if (str.length === 0) {\n    // special-case empty json body, as it's a common client-side mistake\n    return {}\n  }\n\n  try {\n    return JSON.parse(str)\n  } catch (e) {\n    throw new ApiError(400, 'Invalid JSON')\n  }\n}\n\n/**\n * Parsing query arguments from request `url` string\n * @param url of request\n * @returns Object with key name of query argument and its value\n */\nexport function getQueryParser({ url }: IncomingMessage) {\n  return function parseQuery(): NextApiRequestQuery {\n    const { URL } = require('url')\n    // we provide a placeholder base url because we only want searchParams\n    const params = new URL(url, 'https://n').searchParams\n\n    const query: { [key: string]: string | string[] } = {}\n    for (const [key, value] of params) {\n      if (query[key]) {\n        if (Array.isArray(query[key])) {\n          ;(query[key] as string[]).push(value)\n        } else {\n          query[key] = [query[key], value]\n        }\n      } else {\n        query[key] = value\n      }\n    }\n\n    return query\n  }\n}\n\n/**\n * Parse cookies from `req` header\n * @param req request object\n */\nexport function getCookieParser(req: IncomingMessage) {\n  return function parseCookie(): NextApiRequestCookies {\n    const header: undefined | string | string[] = req.headers.cookie\n\n    if (!header) {\n      return {}\n    }\n\n    const { parse: parseCookieFn } = require('next/dist/compiled/cookie')\n    return parseCookieFn(Array.isArray(header) ? header.join(';') : header)\n  }\n}\n\n/**\n *\n * @param res response object\n * @param statusCode `HTTP` status code of response\n */\nexport function sendStatusCode(\n  res: NextApiResponse,\n  statusCode: number\n): NextApiResponse<any> {\n  res.statusCode = statusCode\n  return res\n}\n\n/**\n *\n * @param res response object\n * @param [statusOrUrl] `HTTP` status code of redirect\n * @param url URL of redirect\n */\nexport function redirect(\n  res: NextApiResponse,\n  statusOrUrl: string | number,\n  url?: string\n): NextApiResponse<any> {\n  if (typeof statusOrUrl === 'string') {\n    url = statusOrUrl\n    statusOrUrl = 307\n  }\n  if (typeof statusOrUrl !== 'number' || typeof url !== 'string') {\n    throw new Error(\n      `Invalid redirect arguments. Please use a single argument URL, e.g. res.redirect('/destination') or use a status code and URL, e.g. res.redirect(307, '/destination').`\n    )\n  }\n  res.writeHead(statusOrUrl, { Location: url }).end()\n  return res\n}\n\nfunction sendEtagResponse(\n  req: NextApiRequest,\n  res: NextApiResponse,\n  body: string | Buffer\n): boolean {\n  const etag = generateETag(body)\n\n  if (fresh(req.headers, { etag })) {\n    res.statusCode = 304\n    res.end()\n    return true\n  }\n\n  res.setHeader('ETag', etag)\n  return false\n}\n\n/**\n * Send `any` body to response\n * @param req request object\n * @param res response object\n * @param body of response\n */\nexport function sendData(\n  req: NextApiRequest,\n  res: NextApiResponse,\n  body: any\n): void {\n  if (body === null) {\n    res.end()\n    return\n  }\n\n  const contentType = res.getHeader('Content-Type')\n\n  if (body instanceof Stream) {\n    if (!contentType) {\n      res.setHeader('Content-Type', 'application/octet-stream')\n    }\n    body.pipe(res)\n    return\n  }\n\n  const isJSONLike = ['object', 'number', 'boolean'].includes(typeof body)\n  const stringifiedBody = isJSONLike ? JSON.stringify(body) : body\n\n  if (sendEtagResponse(req, res, stringifiedBody)) {\n    return\n  }\n\n  if (Buffer.isBuffer(body)) {\n    if (!contentType) {\n      res.setHeader('Content-Type', 'application/octet-stream')\n    }\n    res.setHeader('Content-Length', body.length)\n    res.end(body)\n    return\n  }\n\n  if (isJSONLike) {\n    res.setHeader('Content-Type', 'application/json; charset=utf-8')\n  }\n\n  res.setHeader('Content-Length', Buffer.byteLength(stringifiedBody))\n  res.end(stringifiedBody)\n}\n\n/**\n * Send `JSON` object\n * @param res response object\n * @param jsonBody of data\n */\nexport function sendJson(res: NextApiResponse, jsonBody: any): void {\n  // Set header to application/json\n  res.setHeader('Content-Type', 'application/json; charset=utf-8')\n\n  // Use send to handle request\n  res.send(jsonBody)\n}\n\nconst COOKIE_NAME_PRERENDER_BYPASS = `__prerender_bypass`\nconst COOKIE_NAME_PRERENDER_DATA = `__next_preview_data`\n\nexport const SYMBOL_PREVIEW_DATA = Symbol(COOKIE_NAME_PRERENDER_DATA)\nconst SYMBOL_CLEARED_COOKIES = Symbol(COOKIE_NAME_PRERENDER_BYPASS)\n\nexport function tryGetPreviewData(\n  req: IncomingMessage,\n  res: ServerResponse,\n  options: __ApiPreviewProps\n): object | string | false {\n  // Read cached preview data if present\n  if (SYMBOL_PREVIEW_DATA in req) {\n    return (req as any)[SYMBOL_PREVIEW_DATA] as any\n  }\n\n  const getCookies = getCookieParser(req)\n  let cookies: NextApiRequestCookies\n  try {\n    cookies = getCookies()\n  } catch {\n    // TODO: warn\n    return false\n  }\n\n  const hasBypass = COOKIE_NAME_PRERENDER_BYPASS in cookies\n  const hasData = COOKIE_NAME_PRERENDER_DATA in cookies\n\n  // Case: neither cookie is set.\n  if (!(hasBypass || hasData)) {\n    return false\n  }\n\n  // Case: one cookie is set, but not the other.\n  if (hasBypass !== hasData) {\n    clearPreviewData(res as NextApiResponse)\n    return false\n  }\n\n  // Case: preview session is for an old build.\n  if (cookies[COOKIE_NAME_PRERENDER_BYPASS] !== options.previewModeId) {\n    clearPreviewData(res as NextApiResponse)\n    return false\n  }\n\n  const tokenPreviewData = cookies[COOKIE_NAME_PRERENDER_DATA]\n\n  const jsonwebtoken = require('next/dist/compiled/jsonwebtoken') as typeof import('jsonwebtoken')\n  let encryptedPreviewData: {\n    data: string\n  }\n  try {\n    encryptedPreviewData = jsonwebtoken.verify(\n      tokenPreviewData,\n      options.previewModeSigningKey\n    ) as typeof encryptedPreviewData\n  } catch {\n    // TODO: warn\n    clearPreviewData(res as NextApiResponse)\n    return false\n  }\n\n  const decryptedPreviewData = decryptWithSecret(\n    Buffer.from(options.previewModeEncryptionKey),\n    encryptedPreviewData.data\n  )\n\n  try {\n    // TODO: strict runtime type checking\n    const data = JSON.parse(decryptedPreviewData)\n    // Cache lookup\n    Object.defineProperty(req, SYMBOL_PREVIEW_DATA, {\n      value: data,\n      enumerable: false,\n    })\n    return data\n  } catch {\n    return false\n  }\n}\n\nfunction setPreviewData<T>(\n  res: NextApiResponse<T>,\n  data: object | string, // TODO: strict runtime type checking\n  options: {\n    maxAge?: number\n  } & __ApiPreviewProps\n): NextApiResponse<T> {\n  if (\n    typeof options.previewModeId !== 'string' ||\n    options.previewModeId.length < 16\n  ) {\n    throw new Error('invariant: invalid previewModeId')\n  }\n  if (\n    typeof options.previewModeEncryptionKey !== 'string' ||\n    options.previewModeEncryptionKey.length < 16\n  ) {\n    throw new Error('invariant: invalid previewModeEncryptionKey')\n  }\n  if (\n    typeof options.previewModeSigningKey !== 'string' ||\n    options.previewModeSigningKey.length < 16\n  ) {\n    throw new Error('invariant: invalid previewModeSigningKey')\n  }\n\n  const jsonwebtoken = require('next/dist/compiled/jsonwebtoken') as typeof import('jsonwebtoken')\n\n  const payload = jsonwebtoken.sign(\n    {\n      data: encryptWithSecret(\n        Buffer.from(options.previewModeEncryptionKey),\n        JSON.stringify(data)\n      ),\n    },\n    options.previewModeSigningKey,\n    {\n      algorithm: 'HS256',\n      ...(options.maxAge !== undefined\n        ? { expiresIn: options.maxAge }\n        : undefined),\n    }\n  )\n\n  // limit preview mode cookie to 2KB since we shouldn't store too much\n  // data here and browsers drop cookies over 4KB\n  if (payload.length > 2048) {\n    throw new Error(\n      `Preview data is limited to 2KB currently, reduce how much data you are storing as preview data to continue`\n    )\n  }\n\n  const {\n    serialize,\n  } = require('next/dist/compiled/cookie') as typeof import('cookie')\n  const previous = res.getHeader('Set-Cookie')\n  res.setHeader(`Set-Cookie`, [\n    ...(typeof previous === 'string'\n      ? [previous]\n      : Array.isArray(previous)\n      ? previous\n      : []),\n    serialize(COOKIE_NAME_PRERENDER_BYPASS, options.previewModeId, {\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n      ...(options.maxAge !== undefined\n        ? ({ maxAge: options.maxAge } as CookieSerializeOptions)\n        : undefined),\n    }),\n    serialize(COOKIE_NAME_PRERENDER_DATA, payload, {\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n      ...(options.maxAge !== undefined\n        ? ({ maxAge: options.maxAge } as CookieSerializeOptions)\n        : undefined),\n    }),\n  ])\n  return res\n}\n\nfunction clearPreviewData<T>(res: NextApiResponse<T>): NextApiResponse<T> {\n  if (SYMBOL_CLEARED_COOKIES in res) {\n    return res\n  }\n\n  const {\n    serialize,\n  } = require('next/dist/compiled/cookie') as typeof import('cookie')\n  const previous = res.getHeader('Set-Cookie')\n  res.setHeader(`Set-Cookie`, [\n    ...(typeof previous === 'string'\n      ? [previous]\n      : Array.isArray(previous)\n      ? previous\n      : []),\n    serialize(COOKIE_NAME_PRERENDER_BYPASS, '', {\n      // To delete a cookie, set `expires` to a date in the past:\n      // https://tools.ietf.org/html/rfc6265#section-4.1.1\n      // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n      expires: new Date(0),\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n    }),\n    serialize(COOKIE_NAME_PRERENDER_DATA, '', {\n      // To delete a cookie, set `expires` to a date in the past:\n      // https://tools.ietf.org/html/rfc6265#section-4.1.1\n      // `Max-Age: 0` is not valid, thus ignored, and the cookie is persisted.\n      expires: new Date(0),\n      httpOnly: true,\n      sameSite: process.env.NODE_ENV !== 'development' ? 'none' : 'lax',\n      secure: process.env.NODE_ENV !== 'development',\n      path: '/',\n    }),\n  ])\n\n  Object.defineProperty(res, SYMBOL_CLEARED_COOKIES, {\n    value: true,\n    enumerable: false,\n  })\n  return res\n}\n\n/**\n * Custom error class\n */\nexport class ApiError extends Error {\n  readonly statusCode: number\n\n  constructor(statusCode: number, message: string) {\n    super(message)\n    this.statusCode = statusCode\n  }\n}\n\n/**\n * Sends error in `response`\n * @param res response object\n * @param statusCode of response\n * @param message of response\n */\nexport function sendError(\n  res: NextApiResponse,\n  statusCode: number,\n  message: string\n): void {\n  res.statusCode = statusCode\n  res.statusMessage = message\n  res.end(message)\n}\n\ninterface LazyProps {\n  req: NextApiRequest\n  params?: Params | boolean\n}\n\n/**\n * Execute getter function only if its needed\n * @param LazyProps `req` and `params` for lazyProp\n * @param prop name of property\n * @param getter function to get data\n */\nexport function setLazyProp<T>(\n  { req, params }: LazyProps,\n  prop: string,\n  getter: () => T\n): void {\n  const opts = { configurable: true, enumerable: true }\n  const optsReset = { ...opts, writable: true }\n\n  Object.defineProperty(req, prop, {\n    ...opts,\n    get: () => {\n      let value = getter()\n      if (params && typeof params !== 'boolean') {\n        value = { ...value, ...params }\n      }\n      // we set the property on the object to avoid recalculating it\n      Object.defineProperty(req, prop, { ...optsReset, value })\n      return value\n    },\n    set: (value) => {\n      Object.defineProperty(req, prop, { ...optsReset, value })\n    },\n  })\n}\n"]}