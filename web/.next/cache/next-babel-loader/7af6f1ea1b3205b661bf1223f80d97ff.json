{"ast":null,"code":"export default (async (req, res) => {\n  // 1. Destructure the email address from the request body.\n  const {\n    email\n  } = req.body;\n\n  if (!email) {\n    // 2. Throw an error if an email wasn't provided.\n    return res.status(400).json({\n      error: \"Email is required\"\n    });\n  }\n\n  try {\n    // 3. Fetch the environment variables.\n    const LIST_ID = process.env.NEXT_PUBLIC_MAILCHIMP_LIST_ID;\n    const API_KEY = process.env.NEXT_PUBLIC_MAILCHIMP_API_KEY;\n    const DATACENTER = process.env.NEXT_PUBLIC_DATACENTER; // 5. The status of 'subscribed' is equivalent to a double opt-in.\n\n    const data = {\n      email_address: email,\n      status: \"subscribed\"\n    }; // 6. Send a POST request to Mailchimp.\n\n    const response = await fetch(`https://${DATACENTER}.api.mailchimp.com/3.0/lists/${LIST_ID}/members`, {\n      body: JSON.stringify(data),\n      headers: {\n        Authorization: `apikey ${API_KEY}`,\n        \"Content-Type\": \"application/json\"\n      },\n      method: \"POST\"\n    }); // 7. Swallow any errors from Mailchimp and return a better error message.\n\n    if (response.status >= 400) {\n      return res.status(400).json({\n        error: `There was an error subscribing to the newsletter. Shoot me an email at [me@leerob.io] and I'll add you to the list.`\n      });\n    } // 8. If we made it this far, it was a success! ðŸŽ‰\n\n\n    return res.status(201).json({\n      error: \"\"\n    });\n  } catch (error) {\n    return res.status(500).json({\n      error: error.message || error.toString()\n    });\n  }\n});","map":{"version":3,"sources":["/Users/tiffanybouchard/Desktop/workspace/ojos/web/pages/api/subscribe.js"],"names":["req","res","email","body","status","json","error","LIST_ID","process","env","NEXT_PUBLIC_MAILCHIMP_LIST_ID","API_KEY","NEXT_PUBLIC_MAILCHIMP_API_KEY","DATACENTER","NEXT_PUBLIC_DATACENTER","data","email_address","response","fetch","JSON","stringify","headers","Authorization","method","message","toString"],"mappings":"AAAA,gBAAe,OAAOA,GAAP,EAAYC,GAAZ,KAAoB;AACjC;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAYF,GAAG,CAACG,IAAtB;;AAEA,MAAI,CAACD,KAAL,EAAY;AACV;AACA,WAAOD,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAArB,CAAP;AACD;;AAED,MAAI;AACF;AACA,UAAMC,OAAO,GAAGC,OAAO,CAACC,GAAR,CAAYC,6BAA5B;AACA,UAAMC,OAAO,GAAGH,OAAO,CAACC,GAAR,CAAYG,6BAA5B;AACA,UAAMC,UAAU,GAAGL,OAAO,CAACC,GAAR,CAAYK,sBAA/B,CAJE,CAMF;;AACA,UAAMC,IAAI,GAAG;AACXC,MAAAA,aAAa,EAAEd,KADJ;AAEXE,MAAAA,MAAM,EAAE;AAFG,KAAb,CAPE,CAYF;;AACA,UAAMa,QAAQ,GAAG,MAAMC,KAAK,CACzB,WAAUL,UAAW,gCAA+BN,OAAQ,UADnC,EAE1B;AACEJ,MAAAA,IAAI,EAAEgB,IAAI,CAACC,SAAL,CAAeL,IAAf,CADR;AAEEM,MAAAA,OAAO,EAAE;AACPC,QAAAA,aAAa,EAAG,UAASX,OAAQ,EAD1B;AAEP,wBAAgB;AAFT,OAFX;AAMEY,MAAAA,MAAM,EAAE;AANV,KAF0B,CAA5B,CAbE,CAyBF;;AACA,QAAIN,QAAQ,CAACb,MAAT,IAAmB,GAAvB,EAA4B;AAC1B,aAAOH,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAC1BC,QAAAA,KAAK,EAAG;AADkB,OAArB,CAAP;AAGD,KA9BC,CAgCF;;;AACA,WAAOL,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,KAAK,EAAE;AAAT,KAArB,CAAP;AACD,GAlCD,CAkCE,OAAOA,KAAP,EAAc;AACd,WAAOL,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,KAAK,EAAEA,KAAK,CAACkB,OAAN,IAAiBlB,KAAK,CAACmB,QAAN;AAA1B,KAArB,CAAP;AACD;AACF,CA9CD","sourcesContent":["export default async (req, res) => {\n  // 1. Destructure the email address from the request body.\n  const { email } = req.body;\n\n  if (!email) {\n    // 2. Throw an error if an email wasn't provided.\n    return res.status(400).json({ error: \"Email is required\" });\n  }\n\n  try {\n    // 3. Fetch the environment variables.\n    const LIST_ID = process.env.NEXT_PUBLIC_MAILCHIMP_LIST_ID;\n    const API_KEY = process.env.NEXT_PUBLIC_MAILCHIMP_API_KEY;\n    const DATACENTER = process.env.NEXT_PUBLIC_DATACENTER;\n\n    // 5. The status of 'subscribed' is equivalent to a double opt-in.\n    const data = {\n      email_address: email,\n      status: \"subscribed\",\n    };\n\n    // 6. Send a POST request to Mailchimp.\n    const response = await fetch(\n      `https://${DATACENTER}.api.mailchimp.com/3.0/lists/${LIST_ID}/members`,\n      {\n        body: JSON.stringify(data),\n        headers: {\n          Authorization: `apikey ${API_KEY}`,\n          \"Content-Type\": \"application/json\",\n        },\n        method: \"POST\",\n      }\n    );\n\n    // 7. Swallow any errors from Mailchimp and return a better error message.\n    if (response.status >= 400) {\n      return res.status(400).json({\n        error: `There was an error subscribing to the newsletter. Shoot me an email at [me@leerob.io] and I'll add you to the list.`,\n      });\n    }\n\n    // 8. If we made it this far, it was a success! ðŸŽ‰\n    return res.status(201).json({ error: \"\" });\n  } catch (error) {\n    return res.status(500).json({ error: error.message || error.toString() });\n  }\n};\n"]},"metadata":{},"sourceType":"module"}